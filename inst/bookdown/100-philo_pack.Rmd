# Philosophy of PPBstats {#philo}

This chapter describes what is participatory plant breeding, the objectives of `PPBstats`, the analysis according to the objectives and how to install `PPBstats`.


## What is Participatory Plant Bredding ?

### Decentralize the selection

The following is adapted from @bernardo_breeding_2002 and @gallais_theorie_1990.

When considering multiple environments for evaluation and selection, the phenotypic value of a trait of any individual in a given environment can be written as the sum of its random genetic effect (or overall genetic potential, $G$ ), the random environmental effect ($E$) and the random interaction ($G \times E$), i.e. : $P = G + E + G \times E + e$ with $e$ the random residual effect within each environment following a normal distribution $N(0, \sigma^2)$. 

In classical centralized breeding, the objective is to predict the overall genetic potential ($G$) of the candidates for selection to detect the highest values assuming that this potential would express in all farmers’ fields. 
These genetic potentials are predicted based on the average phenotypic values over all testing environments (usually experimental stations) and therefore the broad sense heritability for prediction is :

$h^2_{sl} = \frac{var(G)}{var(G) + 1 n E (var(E) + var(G \times E)) + 1 n E n R var(e)}$

with $n E (resp. nR)$ the number of environments (resp. the number of replicates in each environment). 
As environmental effect and $G \times E$ interactions limit prediction accuracy, the option is to increase the number of environments and to use environments that are homogeneous and similar and that minimize $G \times E$ interactions.

On the contrary, in decentralized on farm breeding, it has been shown that the environments are very contrasted due to diverse pedo-climatic conditions associated to various agroecological farming practices, and that $G \times E$ interactions can be strong [@desclaux_changes_2008]. 
Therefore, the prediction of the overall genotypic value ($G$) is not interesting and the objective is rather to predict the «loca » genetic value which also includes the interaction with the local environment, i.e.: $Gloc_{ij} = G_i + (G \times E)_{ij}$

Then, the genetic variance in each local environment can be written as: $var(Gloc) = var(G) + var(G \times E)$ and the heritability to predict the local genetic value based on the phenotypic value observed in the local environment is:

$h^2_{sl} = \frac{var(Gloc)}{var(Gloc) + 1 n R var(e)} = \frac{var(G) + var(G \times E)}{var(G) + var(G \times E) + 1 n R var(e)}$

It can be noted that the $G \times E$ interactions contribute to both denominator and numerator therefore leading to no limiting effect on prediction accuracy.
Hence, when facing a wide diversity of agroecological environment and practices, decentralized breeding is a key point to select adapted varieties to local agro-systems.



### Involve all actors in the breeding decision process

All actors are part of the breeding programme : farmers, technicians, researchers, facilitators, consumers ... Such involvements empower all actors and answer the real needs of actors  [@sperling_framework_2001].


## Objectives of `PPBstats`

`PPBstats` aims to perform analysis found within PPB programmes at four levels:

- network of seeds circulation (section \@ref(network))

- agronomic trials (section \@ref(agronomic)) in order to set, describe and analyse balanced and unbalanced trials in decentralized participatory plant breeding programmes.
Nutritional data are also dealt here as it is the same data structure as agronomic data.
The statistical procedures are based on frequentist and bayesian approaches.

- organoleptic tests (section \@ref(organoleptic))

- molecular experiments (section \@ref(molecular))

Please, feel free to contribute to other aspects of analysis, see section \@ref(contributions) for more information.


## Design and statistical methods according to the objectives

The analyses of data from PPB programmes aim to address five main objectives:

- **To study networks of seed circulation** throught analysis of network topology (section \@ref(network)).

- **To improve the prediction of a target variable for selection** throught analysis of agronomic and nutritional traits (section \@ref(agronomic)).

- **To compare different varieties or populations (hereafter called germplasms) evaluated for selection in different locations** throught analysis of agronomic and nutritional traits (section \@ref(agronomic)) and sensory analysis (section \@ref(organoleptic)).

- **To study the response of germplasms under selection over several environments** throught analysis of agronomic traits (section \@ref(agronomic)).

- **To study diversity structure and identify parents to cross based on either good complementarity or similarity for some traits** throught analysis of agronomic traits (section \@ref(agronomic)) and molecular data (section \@ref(molecular)).

For each objective, there are severals method based on different experimental designs based on number of plots per location, the number of locations, the number of replicated germplasms within and between locations (section \@ref(doe)).

Figure \@ref(fig:decision-tree-all-head) and \@ref(fig:decision-tree-all) present a decision tree with all objectives, experimental constraints, designs (**D**) and methods (**M**) of analysis carry out in `PPBstats`.
Each branch is explained throught an example for each experimental design and analysis in the corresponding section.

```{r decision-tree-all-head, out.width='100%', fig.align='center', echo=FALSE, fig.cap="Decision tree with objectives and type of analysis carry out in `PPBstats`."}
knitr::include_graphics("figures/decision-tree_all-head.png")
```

```{r decision-tree-all, out.width='100%', fig.align='center', echo=FALSE, fig.cap="Decision tree with objectives, experimental constraints, designs and methods of analysis carry out in `PPBstats`. **D** refers to designs and **M** to methods."}
knitr::include_graphics("figures/decision-tree_all.png")
```


## Let's go: install `PPBstats` !

To continue, load the current development version of the package [here](https://github.com/priviere/PPBstats/archive/v0.23.zip)

unzip the folder and then run 

```{r, eval=FALSE}
devtools::install("PPBstats-0.23")
```

Note that `JAGS` must be installed on your computer. See http://mcmc-jags.sourceforge.net/ for more details.

Then you can load the package :

```{r,warning=FALSE,message=FALSE}
library(PPBstats)
```

and download from internet the data used in this tutorial (this is useful to earn lots of time!) [here](https://github.com/priviere/PPBstats/releases/download/v0.20/data_PPBstats.zip).

The following examples have been performed with the following R version :
```{r}
unlist(sessionInfo()$R.version)
```


