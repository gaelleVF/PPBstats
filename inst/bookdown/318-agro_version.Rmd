### Version {#version}

In this section, the main data set is the one used in $G \times E$ models:

```{r}
data("data_model_GxE")
data_model_GxE = format_data_PPBstats(data_model_GxE, type = "data_agro")
```


#### Reponse to selection

For a given trait, selection differential corresponds to the difference between mean of the selected spikes and
mean of the bulk (i.e. spikes that have not been selected). 
Response to selection correponds to the difference between mean of spikes coming from the selected spikes and the spikes coming from the bulk (Figure \@ref(fig:SR)).
Selection differential ($S$) and response to selection ($R$) are linked with the realized heritability ($h^2_r$):
$R = h^2_r \times S$.

```{r SR, out.width='80%', fig.align='center', echo=FALSE, fig.cap="Seletion differential (S) in 2014-2015 and response to selection (R) in 2015-2016. Circles and arrows in gray represent the seed-lots that have been sown in 2015 after harvest in 2015.[@SandR_EN]"}
knitr::include_graphics("figures/SandR_EN-7.png")
```

##### Format data
```{r}
data("data_version_SR")
data_version_SR = format_data_PPBstats(data_version_SR, type = "data_agro_version")
```
Where `group` represents differential selection (S) or reponse to selection (R) and `version` represents bouquet or vrac.


##### Describe the data

```{r}
p = plot(data_model_GxE, vec_variables = "y1", 
         data_version =data_version_SR, plot_type = "barplot")
p$y1$`loc-1:germ-1`
```


##### Hierarchical Bayesian intra-location model

Version can be studied through the Hierarchical Bayesian intra-location model presented in section \@ref(model-1).

Regarding pairs of entries in a given environment, 
it is possible to get comparison of paris of entries in a given location.
This is useful if you want to compare two versions within a group.
For exemple:
```{r}
data(data_version)
data_version = format_data_PPBstats(data_version, type = "data_agro_version")
head(data_version)
```

Here, in location `loc-1`, `germ-25` and `germ-26` on one hand and `germ-1` and `germ-12` on the other hand are two version belonging to the same groupe.

Lets' make the plots:
```{r, warning=FALSE}
load("./data_PPBstats/out_mean_comparisons_model_bh_intra_location_mu.RData")

p_barplot_mu_version = plot(
  out_mean_comparisons_model_bh_intra_location_mu,
  data_version = data_version,
  plot_type = "barplot"
)
p_barplot_mu_version$data_mean_comparisons$`loc-1:2005`
```

The stars corresponds to the pvalue:

| pvalue | stars |
| --- | --- |
| $< 0.001$ | *** |
| $[0.001 , 0.05]$ | ** |
| $[0.05 , 0.01]$ | * |
| $> 0.01$ | . |


The pvalue is computed as describe in Section \@ref(mean-comp) if the parameters have been estimated with the model.

For environments where MCMC did not converge or without environments, it is a \@ref(t.test) which is perform.

```{r}
p_barplot_mu_version$data_env_with_no_controls
```

```{r}
p_barplot_mu_version$data_env_whose_param_did_not_converge
```


#### Migrant residant {#migrant-residant} (Home away)

##### Format data

```{r}
data("data_version_MR")
data_version_MR = format_data_PPBstats(data_version_MR, type = "data_agro_version")
```
Where `group` represents migrant or residant and `version` represents the location where come the germplasm from.

##### Describe the data

```{r}
p = plot(data_model_GxE, vec_variables = "y1", data_version = data_version_MR, plot_type = "barplot")
p$y1$`loc-1`
```

##### Model 

!!! TO DO !!!

The model is based on frequentist statistics (section \@ref(section-freq)).
The tests to check the model are explained in section \@ref(check-model-freq).
The method to compute mean comparison are explained in section \@ref(mean-comp-check-freq).


